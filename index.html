<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Tarefas</title>
  <link rel="icon" type="image/x-icon" href="/imgs/favicon-32x32.png">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>To-Do List</h1>
      <div class="top-actions">
        <input type="text" id="searchTask" placeholder="Buscar tarefa...">
        <button id="clearAllBtn">Limpar Tudo</button>
        <button id="toggleDarkMode">üåô</button>
      </div>
    </header>

    <div class="input-group">
      <input type="text" id="taskInput" placeholder="Adicione uma nova tarefa...">
      <input type="datetime-local" id="startTime">
      <input type="number" id="duration" placeholder="Prazo (horas)" min="0">
      <button id="addTaskBtn">Adicionar</button>
    </div>

    <ul id="taskList"></ul>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const taskInput = document.getElementById("taskInput");
      const startTime = document.getElementById("startTime");
      const duration = document.getElementById("duration");
      const addTaskBtn = document.getElementById("addTaskBtn");
      const taskList = document.getElementById("taskList");
      const clearAllBtn = document.getElementById("clearAllBtn");
      const searchTask = document.getElementById("searchTask");
      const toggleDarkMode = document.getElementById("toggleDarkMode");

      // Fun√ß√£o para formatar data/hora
      function formatarDataHoraBR(dataISO) {
        if (!dataISO) return "N√£o definido";
        const data = new Date(dataISO);
        const dia = String(data.getDate()).padStart(2, "0");
        const mes = String(data.getMonth() + 1).padStart(2, "0");
        const ano = data.getFullYear();
        const horas = String(data.getHours()).padStart(2, "0");
        const minutos = String(data.getMinutes()).padStart(2, "0");
        return `${dia}/${mes}/${ano} ${horas}:${minutos}`;
      }

      // Carregar tarefas
      function loadTasks(filter = "") {
        const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
        taskList.innerHTML = "";
        tasks.forEach((task, index) => {
          if (task.text.toLowerCase().includes(filter.toLowerCase())) {
            const li = document.createElement("li");
            li.innerHTML = `
              <div class="task-info">
                <span>${task.text}</span>
                <span class="status ${task.status}" data-index="${index}">${task.status}</span>
              </div>
              <div class="task-time">
                In√≠cio: ${formatarDataHoraBR(task.startTime)} | Prazo: ${task.duration || "N√£o definido"} horas
              </div>
              <button class='delete-btn' data-index='${index}'>Remover</button>
            `;
            taskList.appendChild(li);
          }
        });
      }

      // Adicionar tarefa
      function addTask() {
        const taskText = taskInput.value.trim();
        const start = startTime.value;
        const taskDuration = duration.value;
        if (taskText === "") return;
        const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
        tasks.push({ text: taskText, status: "pendente", startTime: start, duration: taskDuration });
        localStorage.setItem("tasks", JSON.stringify(tasks));
        taskInput.value = "";
        startTime.value = "";
        duration.value = "";
        loadTasks();
      }

      // Remover tarefa
      function removeTask(index) {
        const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
        tasks.splice(index, 1);
        localStorage.setItem("tasks", JSON.stringify(tasks));
        loadTasks();
      }

      // Alterar status
      function changeStatus(index) {
        const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
        if (tasks[index].status === "pendente") {
          tasks[index].status = "resolvido";
        } else if (tasks[index].status === "resolvido") {
          tasks[index].status = "finalizado";
        } else {
          tasks[index].status = "pendente";
        }
        localStorage.setItem("tasks", JSON.stringify(tasks));
        loadTasks();
      }

      // Limpar todas tarefas
      function clearAll() {
        localStorage.removeItem("tasks");
        loadTasks();
      }

      // Dark Mode
      function toggleDark() {
        document.body.classList.toggle("dark");
        const isDark = document.body.classList.contains("dark");
        toggleDarkMode.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
        localStorage.setItem("darkMode", isDark ? "enabled" : "disabled");
      }

      // Eventos
      addTaskBtn.addEventListener("click", addTask);
      taskList.addEventListener("click", (event) => {
        if (event.target.classList.contains("delete-btn")) {
          removeTask(event.target.dataset.index);
        } else if (event.target.classList.contains("status")) {
          changeStatus(event.target.dataset.index);
        }
      });
      clearAllBtn.addEventListener("click", clearAll);
      searchTask.addEventListener("input", (e) => loadTasks(e.target.value));
      toggleDarkMode.addEventListener("click", toggleDark);

      // Estado inicial
      loadTasks();
      if (localStorage.getItem("darkMode") === "enabled") {
        document.body.classList.add("dark");
        toggleDarkMode.textContent = "‚òÄÔ∏è";
      }
    });
  </script>
</body>
</html>
